<html>
<head>
</head>
<script>
var allglobals = {}
	alltags = '{\
			"1":{"w1":90001,"m":1,"m1":90051,"t":1,"t1":90061},\
			"2":{"w2":90002,"m":1,"m1":90051,"t":1,"t1":90061},\
			"3":{"w3":90003,"m":1,"m1":90051,"t":1,"t1":90061},\
			"4":{"w4":90004,"m":1,"m1":90051,"t":1,"t1":90061},\
			"5":{"w5":90005,"m":2,"m2":90052,"t":1,"t1":90061},\
			"6":{"w6":90006,"m":2,"m2":90052,"t":1,"t1":90061},\
			"7":{"w7":90007,"m":2,"m2":90052,"t":1,"t1":90061},\
			"8":{"w8":90008,"m":2,"m2":90052,"t":1,"t1":90061},\
			"9":{"w9":90009,"m":3,"m3":90053,"t":1,"t1":90061},\
			"10":{"w10":90010,"m":3,"m3":90053,"t":1,"t1":90061},\
			"11":{"w11":90011,"m":3,"m3":90053,"t":1,"t1":90061},\
			"12":{"w12":90012,"m":3,"m3":90053,"t":1,"t1":90061},\
			"13":{"w13":90013,"m":3,"m3":90053,"t":1,"t1":90061},\
			"14":{"w14":90014,"m":4,"m4":90054,"t":2,"t2":90062},\
			"15":{"w15":90015,"m":4,"m4":90054,"t":2,"t2":90062},\
			"16":{"w16":90016,"m":4,"m4":90054,"t":2,"t2":90062},\
			"17":{"w17":90017,"m":4,"m4":90054,"t":2,"t2":90062},\
			"18":{"w18":90018,"m":5,"m5":90055,"t":2,"t2":90062},\
			"19":{"w19":90019,"m":5,"m5":90055,"t":2,"t2":90062},\
			"20":{"w20":90020,"m":5,"m5":90055,"t":2,"t2":90062},\
			"21":{"w21":90021,"m":5,"m5":90055,"t":2,"t2":90062},\
			"22":{"w22":90022,"m":6,"m6":90056,"t":2,"t2":90062},\
			"23":{"w23":90023,"m":6,"m6":90056,"t":2,"t2":90062},\
			"24":{"w24":90024,"m":6,"m6":90056,"t":2,"t2":90062},\
			"25":{"w25":90025,"m":6,"m6":90056,"t":2,"t2":90062},\
			"26":{"w26":90026,"m":6,"m6":90056,"t":2,"t2":90062},\
			"27":{"w27":90027,"m":7,"m7":90057,"t":3,"t3":90063},\
			"28":{"w28":90028,"m":7,"m7":90057,"t":3,"t3":90063},\
			"29":{"w29":90029,"m":7,"m7":90057,"t":3,"t3":90063},\
			"30":{"w30":90030,"m":7,"m7":90057,"t":3,"t3":90063},\
			"31":{"w31":90031,"m":8,"m8":90058,"t":3,"t3":90063},\
			"32":{"w32":90032,"m":8,"m8":90058,"t":3,"t3":90063},\
			"33":{"w33":90033,"m":8,"m8":90058,"t":3,"t3":90063},\
			"34":{"w34":90034,"m":8,"m8":90058,"t":3,"t3":90063},\
			"35":{"w35":90035,"m":8,"m8":90058,"t":3,"t3":90063},\
			"36":{"w36":90036,"m":9,"m9":90059,"t":3,"t3":90063},\
			"37":{"w37":90037,"m":9,"m9":90059,"t":3,"t3":90063},\
			"38":{"w38":90038,"m":9,"m9":90059,"t":3,"t3":90063},\
			"39":{"w39":90039,"m":9,"m9":90059,"t":3,"t3":90063},\
			"40":{"w40":90040,"m":9,"m9":90059,"t":3,"t3":90063},\
			"41":{"w41":90041,"m":9,"m9":90059,"t":3,"t3":90063},\
			"42":{"w42":90042,"m":9,"m9":90059,"t":3,"t3":90063},\
			"43":{"w43":90043,"m":9,"m9":90059,"t":3,"t3":90063},\
			"44":{"w44":90044,"m":9,"m9":90059,"t":3,"t3":90063},\
			"45":{"w45":90045,"m":9,"m9":90059,"t":3,"t3":90063}\
			}';
		allglobals = JSON.parse(alltags)
</script>
<script>

	function calculate(){
		var results = document.getElementById('results');
		results.innerHTML = '...'
		var tags = document.getElementById('tags');
		tags.innerHTML = '...'

		var myDD = document.getElementById('myDDField').value;
		if( myDD.length==0 ){
		   alert('Please enter a valid DueDate.');
			return;
		}

		r = calc_weeks(new Date(myDD))	
		var s = ''
		var t = ''
		s = formatbasemsg(r)
		if(r['oldduedate']==true || 
			r['futureduedate']==true){
			s += formaterrormsg(r)
		}
		else {
			s += formatweeksmsg(r)
			t += formattags(r)
		}
			
		results.innerHTML = s
		tags.innerHTML = t
	}
	function formatbasemsg(data){
		EOL = '<BR/>'
		s = ''
		s += 'Today\'s Date : ' + data.today.toLocaleDateString("en-US") + EOL
		s += 'Due Date : ' + data.dd.toLocaleDateString("en-US") + EOL
		s += 'Conception Date : ' + data.concept_date.toLocaleDateString("en-US") + EOL
		return s
	}
	function formaterrormsg(data){
		s = ''
		if (data.oldduedate){
			s += "Due Date in Past! Congratulations!"
			return s
		}
		if (data.futureduedate){
			s += "Conception Date in the Future! Good Luck!"
			return s
		}
	}
	function formatweeksmsg(data){
		s = ''
		s += 'You are ' + data.weekspreg + ' weeks and ' 
				+ data.daysafterweekspreg + ' days pregnant' + EOL
		s += 'You are ' + data.monthspreg + ' months pregnant and in trimester '
				+ data.trimester_of_preg + ' of pregnancy' + EOL

		s += 'You are in week ' + data.weekofpreg + ' of your pregnancy' + EOL
		s += 'You are in month ' + data.monthspreg + ' of pregnancy and in trimester ' 
				+ data.trimester_of_preg + ' of pregnancy' + EOL

		return s
	}
	function formattags(data){
		EOL = '<BR/>'
		s = ''
		s += 'Tags used for you ' + EOL
		s += data.monthtag + EOL
		s += data.trimestertag + EOL
		s += '90000' + EOL

		return s
	}

	function calc_month(week){
		wtags = allglobals[week]
		if(wtags == null)
			return 'NoMonth'
		ret = {}
		ret['m'] = wtags['m']
		ret['mtag'] = wtags['m'+wtags['m']]
		return ret
	}	
	function calc_trimester(week){
		wtags = allglobals[week]
		if(wtags == null)
			return 'NoTrimester'
		ret = {}
		ret['t'] = wtags['t']
		ret['ttag'] = wtags['t'+wtags['t']]
		return ret
	}	
	function default_date(){
		today_date = new Date(Date.now());
		due_date = new Date(today_date);
		due_date.setDate(today_date.getDate() + 200);
		return due_date.toLocaleDateString("en-US");
	}
	function calc_weeks(due_date){
		var r = {}
		today_date = new Date(Date.now())
		//due_date = new Date('2016-06-13')
		concept_date = new Date(due_date);
		concept_date.setDate(due_date.getDate() - 266);
		date_4_calc = new Date(due_date);
		date_4_calc.setDate(due_date.getDate() - 280);

		r['dd'] = due_date
		r['today'] = today_date
		r['concept_date'] = concept_date
		
		if (due_date < today_date){
			r['oldduedate'] = true
			return r
		}
		if (concept_date > today_date){
			r['futureduedate'] = true
			return r
		}

		diff = today_date - date_4_calc
		d = diff/1000/60/60/24
		w = Math.floor(d/7)
		wd = Math.round(d%7)
		wop = Math.ceil(d/7)
		m_info = calc_month(w)
		t_info = calc_trimester(w)

		r['weekspreg'] = w
		r['daysafterweekspreg'] = wd
		r['weekofpreg'] = wop
		r['monthspreg'] = m_info['m']
		r['trimester_of_preg'] = t_info['t']
		r['monthtag'] = m_info['mtag']
		r['trimestertag'] = t_info['ttag']
		
		return r;
	}
	function addLoadEvent(func) {
		var oldonload = window.onload;
		if (typeof window.onload != 'function') {
			window.onload = func;
		} else {
			window.onload = function() {
				if (oldonload) {
					oldonload();
				}
				func();
			}
		}
	}
	addLoadEvent(function(){
		dd = document.getElementById('myDDField');
		dd.value = default_date()
	})
</script>
<body>
	<h1 id="title">The Computer</h1>
	<input type="text" id="myDDField" value="06/21/2016"/>
	<input type="submit" id="byBtn" value="Calculate" onclick="calculate()"/>
	<hr>
	<h2 id="results">...</h2>
	<hr>
	<h3 id="tags">...</h3>
</body>
</html>

